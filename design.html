<!DOCTYPE html>
<!--
 | Generated by Apache Maven Doxia at Mar 11, 2013
 | Rendered using Apache Maven Fluido Skin 1.3.0
-->
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="Date-Revision-yyyymmdd" content="20130311" />
    <meta http-equiv="Content-Language" content="en" />
    <title>Maven - </title>
    <link rel="stylesheet" href="./css/apache-maven-fluido-1.3.0.min.css" />
    <link rel="stylesheet" href="./css/site.css" />
    <link rel="stylesheet" href="./css/print.css" media="print" />

      
    <script type="text/javascript" src="./js/apache-maven-fluido-1.3.0.min.js"></script>

    
            </head>
        <body class="topBarDisabled">
          
        
    
        <div class="container-fluid">
          <div id="banner">
        <div class="pull-left">
                                <div id="bannerLeft">
                <h2>Sample Markdown Documentation Project</h2>
                </div>
                      </div>
        <div class="pull-right">  </div>
        <div class="clear"><hr/></div>
      </div>

      <div id="breadcrumbs">
        <ul class="breadcrumb">
                
            
                  <li id="publishDate">Last Published: 2013-03-11</li>
                  <li class="divider">|</li> <li id="projectVersion">Version: 1.0.0-SNAPSHOT</li>
                      
                
            
      
                                              
    <li class="pull-right">              <a href="http://www.epam.com" class="externalLink" title="EPAM">
        EPAM</a>
  </li>

        <li class="divider pull-right">|</li>
      
    <li class="pull-right">              <a href="http://code.google.com/p/doxia-module-markdown/" class="externalLink" title="doxia-markdown">
        doxia-markdown</a>
  </li>

        <li class="divider pull-right">|</li>
      
    <li class="pull-right">              <a href="http://maven.apache.org/" class="externalLink" title="Maven 2">
        Maven 2</a>
  </li>

        <li class="divider pull-right">|</li>
      
    <li class="pull-right">              <a href="http://www.apache.org/" class="externalLink" title="Apache">
        Apache</a>
  </li>

                        </ul>
      </div>

            
      <div class="row-fluid">
        <div id="leftColumn" class="span3">
          <div class="well sidebar-nav">
                
            
                <ul class="nav nav-list">
                    <li class="nav-header">Markdown Snippet Macro</li>
                                
      <li>
    
                          <a href="index.html" title="Introduction">
          <i class="none"></i>
        Introduction</a>
            </li>
                  
      <li>
    
                          <a href="usage.html" title="Usage">
          <i class="none"></i>
        Usage</a>
            </li>
                  
      <li class="active">
    
            <a href="#"><i class="none"></i>Design</a>
          </li>
                  
      <li>
    
                          <a href="faq.html" title="Faq">
          <i class="none"></i>
        Faq</a>
            </li>
                              <li class="nav-header">Project Documentation</li>
                                                                                                                                                                                                                                                                                                          
      <li>
    
                          <a href="project-info.html" title="Project Information">
          <i class="icon-chevron-right"></i>
        Project Information</a>
                  </li>
            </ul>
                
            
                
          <hr class="divider" />

           <div id="poweredBy">
                            <div class="clear"></div>
                            <div class="clear"></div>
                            <div class="clear"></div>
                             <a href="http://maven.apache.org/" title="Built by Maven" class="poweredBy">
        <img class="builtBy" alt="Built by Maven" src="./images/logos/maven-feather.png" />
      </a>
                  </div>
          </div>
        </div>
        
                
        <div id="bodyColumn"  class="span9" >
                                  
            <h2>Design of the snippet handling</h2>

<p>The file <code>snippet</code> contains 24 lines:</p>

<pre><code>  1 #set( $snippetFilePath = "${project.basedir}" + $snippetFile )
  2 #set( $snippetWasFound = "$snippetName" == "" )
  3 #if( $snippetWasFound )
  4 #set( $snippetStartString = "
  5 " )
  6 #set( $snippetEndString = "
  7 " )
  8 #else
  9 #set( $snippetStartString = "START SNIPPET: " + $snippetName )
 10 #set( $snippetEndString = "END SNIPPET: " + $snippetName )
 11 #end
 12 #foreach( $snippetLine in $StringUtils.split($FileUtils.fileRead( $snippetFilePath ),"
 13 ") )
 14 #set( $checkLine = $StringUtils.removeDuplicateWhitespace( $snippetLine ) )
 15 #if( $StringUtils.contains( $checkLine, $snippetEndString ) )
 16 #set($snippetWasFound = false)
 17 #end
 18 #if( $snippetWasFound )
 19     $snippetLine
 20 #end
 21 #if( $StringUtils.contains( $checkLine, $snippetStartString ) )
 22 #set($snippetWasFound = true)
 23 #end
 24 #end
</code></pre>

<p>It uses the <code>$StringUtils</code> plexus utility class that is available in the velocity context when maven executes the site plugin.
The macros first calculate the full path to the sample file, then it calculates the snippet start and snippet end strings. If the name of the snippet is <code>null</code> or <code>""</code> empty string then it assumes that the whole file has to be included. In this was the variable <code>$snippetWasFound</code> is true when the processing of the file starts and remains so because the file is split to lines along the new line characters and since the start and end strings in this case are set to contain new line character, no line can contain that.</p>

<p>If there is a name specified then the snippet start and end strings are computed normally and the <code>$snippetWasFound</code> variable is false by default.</p>

<p>On line 12 the file content is read into a single, huge string and is split along the newline characters. Note that this is a speciality of velocity that you can not write <code>\n</code> in the string to denote a new line character, but you can break the line and the line breaking new line character will become part of the string. The variable <code>$snippetLine</code> will go though in the cycle on the lines of the file and when the start of the snippet is found then the variable <code>$snippetWasFound</code> will be set to true and when the end line is found <code>$snippetWasFound</code> is set to false.</p>

<p>Note that this implementation makes it possible to have a snippet in a single source file that is at different parts of the file, each having a start and end snippet line.</p>

                  </div>
            </div>
          </div>

    <hr/>

    <footer>
            <div class="container-fluid">
              <div class="row span12">Copyright &copy;                   2013.
          All Rights Reserved.      
            
      </div>

        
        
                </div>
    </footer>
  </body>
</html>
